// PixelGrid and PixelGrid Glimmer 1.0.0
// Developed by Sandakelum Senevirathna (www.facebook.com/iamsandakelum)
// 
// Copyright (c) 2022 Sandakelum Senevirathna
// 
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
// 
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
// 
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.

function PixelGrid(t,o,r){this.root=t,this.width=o,this.height=r,this.pixels=null,this.create()}PixelGrid.prototype={create:function(){for(var t=[],o=this.root,r=this.width,e=this.height,a=0;a<e;a++){for(var l=document.createElement("tr"),h=[],i=0;i<r;i++){var s=document.createElement("td");h.push([s.style,[0,0,0],{}]),l.appendChild(s)}o.appendChild(l),t.push(h)}this.pixels=t},fillRandom:function(t,o){for(var r=this.width,e=this.height,a=t[0]-o[0],l=t[1]-o[1],h=t[2]-o[2],i=2*o[0],s=2*o[1],n=2*o[2],f=[null,null,null],d=0;d<e;d++)for(var M=0;M<r;M++){var m=a+Math.random()*i,c=l+Math.random()*s,u=h+Math.random()*n;this._hsv2rgb(m,c,u,f),this.set(M,d,f[0],f[1],f[2])}},get:function(t,o){var r=this.pixels[o][t][1];return[r[0],r[1],r[2]]},extra:function(t,o){return this.pixels[o][t][2]},set:function(t,o,r,e,a){var l=this.pixels[o][t];l[0].backgroundColor="rgb("+r+","+e+","+a+")",l[1][0]=r,l[1][1]=e,l[1][2]=a},_hsv2rgb:function(t,o,r,e){var a,l,h,i,s;switch(a=Math.floor(t/60)%6,l=t/60-a,h=r*(1-o),i=r*(1-l*o),s=r*(1-(1-l)*o),a){case 0:return e[0]=Math.floor(255*r),e[1]=Math.floor(255*s),void(e[2]=Math.floor(255*h));case 1:return e[0]=Math.floor(255*i),e[1]=Math.floor(255*r),void(e[2]=Math.floor(255*h));case 2:return e[0]=Math.floor(255*h),e[1]=Math.floor(255*r),void(e[2]=Math.floor(255*s));case 3:return e[0]=Math.floor(255*h),e[1]=Math.floor(255*i),void(e[2]=Math.floor(255*r));case 4:return e[0]=Math.floor(255*s),e[1]=Math.floor(255*h),void(e[2]=Math.floor(255*r));case 5:return e[0]=Math.floor(255*r),e[1]=Math.floor(255*h),void(e[2]=Math.floor(255*i))}}},PixelGrid.Glimmer=function(t,o){for(var r=[],e=0;e<o;e++)r.push({delay:7*e,max_delay:70,completed:!0});setInterval(function(){for(var e=0;e<o;e++){var a=r[e];if(a.completed)if(a.delay>0)a.delay-=1;else{var l;do{a.x=Math.floor(Math.random()*t.width),a.y=Math.floor(Math.random()*t.height),l=t.extra(a.x,a.y)}while(l.animating);l.animating=!0,a.to=t.get(a.x,a.y),a.from=[210,245,240],a.delta=[a.to[0]-a.from[0],a.to[1]-a.from[1],a.to[2]-a.from[2]],a.progress=0,a.completed=!1}else t.set(a.x,a.y,Math.floor(a.from[0]+a.delta[0]*a.progress),Math.floor(a.from[1]+a.delta[1]*a.progress),Math.floor(a.from[2]+a.delta[2]*a.progress)),a.progress+=.04,a.progress>=1&&(a.delay=a.max_delay,a.completed=!0,t.set(a.x,a.y,a.to[0],a.to[1],a.to[2]),t.extra(a.x,a.y).animating=!1)}},30)};
